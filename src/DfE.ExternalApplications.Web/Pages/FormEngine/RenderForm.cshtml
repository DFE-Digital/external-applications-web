@page "/applications/{referenceNumber}/{taskId?}/{pageId?}"
@using DfE.ExternalApplications.Infrastructure.Services
@using DfE.ExternalApplications.Application.Interfaces
@using GovUk.Frontend.AspNetCore.TagHelpers
@model RenderFormModel
@{
    ViewData["Title"] = "New application";
    var allTasksCompleted = Model.AreAllTasksCompleted();
}

@switch (Model.CurrentFormState)
{
    case FormState.TaskList:
        @await Html.PartialAsync("FormEngine/_TaskList", Model)
        break;
    case FormState.FormPage:
        @await Html.PartialAsync("FormEngine/_FormPage", Model)
        break;
    case FormState.TaskSummary:
        // If this task declares a collectionFlow summary, render the custom summary
        if (Model.CurrentTask?.Summary?.Mode?.ToLowerInvariant() == "collectionflow")
        {
            @await Html.PartialAsync("FormEngine/_CollectionFlowSummary", Model)
        }
        else
        {
            @await Html.PartialAsync("FormEngine/_TaskSummary", Model)
        }
        break;
    case FormState.ApplicationPreview:
        @await Html.PartialAsync("FormEngine/_ApplicationPreview", Model)
        break;
}